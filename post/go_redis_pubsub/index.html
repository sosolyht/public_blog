<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Go] Go언어로 redis pub sub 구현 | V8 Network</title><meta name=keywords content="메시지큐,redis pubsub,golam,mq"><meta name=description content="Go 언어로 Redis pubsub 구현 필수 패키지 Mac 기준입니다.
brew install redis brew 로 redis 설치하게 되면 Redis7 로 설치됩니다.
저희가 사용할 go-redis 는 현재 Redis6 가 stable 버전임을 참고바랍니다.
go get github.com/go-redis/redis/v8 v8 = Redis6 (stable)
v9 = Redis7 (beta)
하지만 테스트 해본결과 큰 문제가 없습니다.
라우터의 경우 뭘 사용해도 상관없습니다. (다만 body 바인딩 부분에서 조금의 차이가 있을 수 있습니다.)
저는 AWS API Gateway 와 AWS Lambda 도 같이 사용할수있는"><meta name=author content="Me"><link rel=canonical href=https://v8.network/post/go_redis_pubsub/><meta name=google-site-verification content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://v8.network/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://v8.network/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://v8.network/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://v8.network/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://v8.network/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-KGP0XNM9N5"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KGP0XNM9N5",{anonymize_ip:!1})}</script><meta property="og:title" content="[Go] Go언어로 redis pub sub 구현"><meta property="og:description" content="Go 언어로 Redis pubsub 구현 필수 패키지 Mac 기준입니다.
brew install redis brew 로 redis 설치하게 되면 Redis7 로 설치됩니다.
저희가 사용할 go-redis 는 현재 Redis6 가 stable 버전임을 참고바랍니다.
go get github.com/go-redis/redis/v8 v8 = Redis6 (stable)
v9 = Redis7 (beta)
하지만 테스트 해본결과 큰 문제가 없습니다.
라우터의 경우 뭘 사용해도 상관없습니다. (다만 body 바인딩 부분에서 조금의 차이가 있을 수 있습니다.)
저는 AWS API Gateway 와 AWS Lambda 도 같이 사용할수있는"><meta property="og:type" content="article"><meta property="og:url" content="https://v8.network/post/go_redis_pubsub/"><meta property="og:image" content="https://v8.network/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-22T00:00:00+00:00"><meta property="og:site_name" content="V8 Network"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://v8.network/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[Go] Go언어로 redis pub sub 구현"><meta name=twitter:description content="Go 언어로 Redis pubsub 구현 필수 패키지 Mac 기준입니다.
brew install redis brew 로 redis 설치하게 되면 Redis7 로 설치됩니다.
저희가 사용할 go-redis 는 현재 Redis6 가 stable 버전임을 참고바랍니다.
go get github.com/go-redis/redis/v8 v8 = Redis6 (stable)
v9 = Redis7 (beta)
하지만 테스트 해본결과 큰 문제가 없습니다.
라우터의 경우 뭘 사용해도 상관없습니다. (다만 body 바인딩 부분에서 조금의 차이가 있을 수 있습니다.)
저는 AWS API Gateway 와 AWS Lambda 도 같이 사용할수있는"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://v8.network/post/"},{"@type":"ListItem","position":3,"name":"[Go] Go언어로 redis pub sub 구현","item":"https://v8.network/post/go_redis_pubsub/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Go] Go언어로 redis pub sub 구현","name":"[Go] Go언어로 redis pub sub 구현","description":"Go 언어로 Redis pubsub 구현 필수 패키지 Mac 기준입니다.\nbrew install redis brew 로 redis 설치하게 되면 Redis7 로 설치됩니다.\n저희가 사용할 go-redis 는 현재 Redis6 가 stable 버전임을 참고바랍니다.\ngo get github.com/go-redis/redis/v8 v8 = Redis6 (stable)\nv9 = Redis7 (beta)\n하지만 테스트 해본결과 큰 문제가 없습니다.\n라우터의 경우 뭘 사용해도 상관없습니다. (다만 body 바인딩 부분에서 조금의 차이가 있을 수 있습니다.)\n저는 AWS API Gateway 와 AWS Lambda 도 같이 사용할수있는","keywords":["메시지큐","redis pubsub","golam","mq"],"articleBody":"Go 언어로 Redis pubsub 구현 필수 패키지 Mac 기준입니다.\nbrew install redis brew 로 redis 설치하게 되면 Redis7 로 설치됩니다.\n저희가 사용할 go-redis 는 현재 Redis6 가 stable 버전임을 참고바랍니다.\ngo get github.com/go-redis/redis/v8 v8 = Redis6 (stable)\nv9 = Redis7 (beta)\n하지만 테스트 해본결과 큰 문제가 없습니다.\n라우터의 경우 뭘 사용해도 상관없습니다. (다만 body 바인딩 부분에서 조금의 차이가 있을 수 있습니다.)\n저는 AWS API Gateway 와 AWS Lambda 도 같이 사용할수있는\nhttp 라우터 golam 을 사용하였습니다.\ngo get github.com/unsafe-risk/golam PubSub 구현 먼저 redis 의 pubsub 아키텍처가 무엇인지 확인해보자.\n참고링크 : https://medium.com/frientrip/pub-sub-%EC%9E%98-%EC%95%8C%EA%B3%A0-%EC%93%B0%EC%9E%90-de9dc1b9f739\nkafka 와 redis 아키텍쳐에 대한 비교글도있으니 참고하면 좋을듯싶다.\n나중에 kafka 에 대해서도 다뤄볼 기회가 있다면 다뤄보고싶다.\n├── go.mod ├── go.sum ├── redis │ ├── dump.rdb │ ├── pub │ │ └── main.go │ └── sub │ └── main.go publisher 의 경우 golam 으로 라우팅하여 POST 메소드로 메시지를 채널로 전송하였습니다.\nsubscriber 는 redis 채널로 메시지를 전송받게끔 구현하였습니다.\npub/main.go var redisClient = redis.NewClient(\u0026redis.Options{ Addr: \"localhost:6379\", }) var ctx = context.Background() type User struct { Name string `json:\"name\"` Email string `json:\"email\"` } func main() { g := golam.New() g.POST(\"/\", PostString) log.Print(\"Start server\") err := g.StartWithLocalAddr(\":3000\") if err != nil { log.Print(err) } } func PostString(c golam.Context) error { var user User body := c.Request().Body data := []byte(body) json.Unmarshal(data, \u0026user) payload, err := json.Marshal(user) if err != nil { panic(err) } if err := redisClient.Publish(ctx, \"채널명\", payload).Err(); err != nil { log.Print(err) } return c.String(http.StatusOK, \"good\") } redis 의 기본 포트인 6379 로 새로운 클라이언트 시작\nvar redisClient = redis.NewClient(\u0026redis.Options{ Addr: \"localhost:6379\", }) Publish 메소드를 보면 채널에 메시지를 작성한다네요\n필요한 인자는 채널명과 메시지네요.\n채널명과 메시지를 적어줍시다.\n메시지는 payload 에 json 마샬링이 된 User 구조체가 담겨져있습니다.\n이렇게 하면 publisher 는 완성이 되었습니다.\nif err := redisClient.Publish(ctx, \"채널명\", payload).Err(); err != nil { log.Print(err) } subscriber 를 마무리 해봅시다.\nsub/main.go var ctx = context.Background() var redisClient = redis.NewClient(\u0026redis.Options{ Addr: \"localhost:6379\", }) type User struct { Name string `json:\"name\"` Email string `json:\"email\"` } func main() { subscriber := redisClient.Subscribe(ctx, \"채널명\") user := User{} for { msg, err := subscriber.ReceiveMessage(ctx) if err != nil { panic(err) } if err := json.Unmarshal([]byte(msg.Payload), \u0026user); err != nil { panic(err) } fmt.Println(\"메시지가\" + msg.Channel + \" 채널에서 왔습니다.\\n\\n\") fmt.Printf(\"%+v\\n\\n\", user) } } subscriber 는 메시지를 받는 입장이니 publisher 채널을 구독해주어야겠죠.\npublisher 에서 생성했던 채널을 구독해줍시다.\nsubscriber := redisClient.Subscribe(ctx, \"채널명\") 그리고 반복문을 돌며 메시지를 수신해주도록 하면됩니다.\nfor { msg, err := subscriber.ReceiveMessage(ctx) if err != nil { panic(err) } if err := json.Unmarshal([]byte(msg.Payload), \u0026user); err != nil { panic(err) } fmt.Println(\"메시지가\" + msg.Channel + \" 채널에서 왔습니다.\\n\\n\") fmt.Printf(\"%+v\\n\\n\", user) } 실행 터미널 두개로 pub 과 sub 두개를 동시에 실행하였습니다.\npublisher 실행\ncd pub go run main.go subscriber 실행\ncd sub go run main.go ","wordCount":"442","inLanguage":"en","datePublished":"2022-08-22T00:00:00Z","dateModified":"2022-08-22T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://v8.network/post/go_redis_pubsub/"},"publisher":{"@type":"Organization","name":"V8 Network","logo":{"@type":"ImageObject","url":"https://v8.network/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://v8.network accesskey=h title="V8 Network (Alt + H)"><img src=https://v8.network/apple-touch-icon.png alt aria-label=logo height=35>V8 Network</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://v8.network/categories/ title=categories><span>categories</span></a></li><li><a href=https://v8.network/tags/ title=tags><span>tags</span></a></li><li><a href=https://github.com/sosolyht title=github><span>github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://v8.network>Home</a>&nbsp;»&nbsp;<a href=https://v8.network/post/>Posts</a></div><h1 class=post-title>[Go] Go언어로 redis pub sub 구현</h1><div class=post-meta><span title='2022-08-22 00:00:00 +0000 UTC'>August 22, 2022</span>&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/post/go_redis_pubsub.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#필수-패키지>필수 패키지</a></li><li><a href=#pubsub-구현>PubSub 구현</a></li><li><a href=#실행>실행</a></li></ul></nav></div></details></div><div class=post-content><h1 id=go-언어로-redis-pubsub-구현>Go 언어로 Redis pubsub 구현<a hidden class=anchor aria-hidden=true href=#go-언어로-redis-pubsub-구현>#</a></h1><h2 id=필수-패키지>필수 패키지<a hidden class=anchor aria-hidden=true href=#필수-패키지>#</a></h2><p>Mac 기준입니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install redis
</span></span></code></pre></div><p>brew 로 redis 설치하게 되면 Redis7 로 설치됩니다.</p><p>저희가 사용할 go-redis 는 현재 Redis6 가 stable 버전임을 참고바랍니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=k>go</span><span class=o>-</span><span class=nx>redis</span><span class=o>/</span><span class=nx>redis</span><span class=o>/</span><span class=nx>v8</span>
</span></span></code></pre></div><p>v8 = Redis6 (stable)</p><p>v9 = Redis7 (beta)</p><p>하지만 테스트 해본결과 큰 문제가 없습니다.</p><p>라우터의 경우 뭘 사용해도 상관없습니다. (다만 body 바인딩 부분에서 조금의 차이가 있을 수 있습니다.)</p><p>저는 AWS API Gateway 와 AWS Lambda 도 같이 사용할수있는</p><p>http 라우터 golam 을 사용하였습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>unsafe</span><span class=o>-</span><span class=nx>risk</span><span class=o>/</span><span class=nx>golam</span>
</span></span></code></pre></div><h2 id=pubsub-구현>PubSub 구현<a hidden class=anchor aria-hidden=true href=#pubsub-구현>#</a></h2><p>먼저 redis 의 pubsub 아키텍처가 무엇인지 확인해보자.</p><p>참고링크 : <a href=https://medium.com/frientrip/pub-sub-%EC%9E%98-%EC%95%8C%EA%B3%A0-%EC%93%B0%EC%9E%90-de9dc1b9f739>https://medium.com/frientrip/pub-sub-%EC%9E%98-%EC%95%8C%EA%B3%A0-%EC%93%B0%EC%9E%90-de9dc1b9f739</a></p><p>kafka 와 redis 아키텍쳐에 대한 비교글도있으니 참고하면 좋을듯싶다.</p><p>나중에 kafka 에 대해서도 다뤄볼 기회가 있다면 다뤄보고싶다.</p><p><img loading=lazy src=https://user-images.githubusercontent.com/2377807/185931263-d0db0458-e468-4d1d-a1d3-d06687002e90.png alt="redis pubsub arichitecture"></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>├── go.mod
</span></span><span class=line><span class=cl>├── go.sum
</span></span><span class=line><span class=cl>├── redis
</span></span><span class=line><span class=cl>│   ├── dump.rdb
</span></span><span class=line><span class=cl>│   ├── pub
</span></span><span class=line><span class=cl>│   │   └── main.go
</span></span><span class=line><span class=cl>│   └── sub
</span></span><span class=line><span class=cl>│       └── main.go
</span></span></code></pre></div><p><strong>publisher</strong> 의 경우 golam 으로 라우팅하여 <code>POST</code> 메소드로 메시지를 채널로 전송하였습니다.</p><p><strong>subscriber</strong> 는 redis 채널로 메시지를 전송받게끔 구현하였습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>pub</span><span class=o>/</span><span class=nx>main</span><span class=p>.</span><span class=k>go</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>redisClient</span> <span class=p>=</span> <span class=nx>redis</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Addr</span><span class=p>:</span> <span class=s>&#34;localhost:6379&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>ctx</span> <span class=p>=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>User</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Name</span>  <span class=kt>string</span> <span class=s>`json:&#34;name&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Email</span> <span class=kt>string</span> <span class=s>`json:&#34;email&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>g</span> <span class=o>:=</span> <span class=nx>golam</span><span class=p>.</span><span class=nf>New</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>g</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span> <span class=nx>PostString</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Print</span><span class=p>(</span><span class=s>&#34;Start server&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>g</span><span class=p>.</span><span class=nf>StartWithLocalAddr</span><span class=p>(</span><span class=s>&#34;:3000&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Print</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>PostString</span><span class=p>(</span><span class=nx>c</span> <span class=nx>golam</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>user</span> <span class=nx>User</span>
</span></span><span class=line><span class=cl>	<span class=nx>body</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>Request</span><span class=p>().</span><span class=nx>Body</span>
</span></span><span class=line><span class=cl>	<span class=nx>data</span> <span class=o>:=</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>json</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>payload</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Marshal</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nf>Publish</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;채널명&#34;</span><span class=p>,</span> <span class=nx>payload</span><span class=p>).</span><span class=nf>Err</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Print</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>c</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=s>&#34;good&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>redis 의 기본 포트인 <code>6379</code> 로 새로운 클라이언트 시작</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>redisClient</span> <span class=p>=</span> <span class=nx>redis</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Addr</span><span class=p>:</span> <span class=s>&#34;localhost:6379&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>Publish 메소드를 보면 채널에 메시지를 작성한다네요</p><p>필요한 인자는 채널명과 메시지네요.</p><p>채널명과 메시지를 적어줍시다.</p><p>메시지는 payload 에 json 마샬링이 된 User 구조체가 담겨져있습니다.</p><p><img loading=lazy src=https://user-images.githubusercontent.com/2377807/185935366-1c0fe30d-44d1-4dc8-b8e3-99a126555df5.png alt=redis></p><p>이렇게 하면 publisher 는 완성이 되었습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nf>Publish</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;채널명&#34;</span><span class=p>,</span> <span class=nx>payload</span><span class=p>).</span><span class=nf>Err</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>log</span><span class=p>.</span><span class=nf>Print</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>subscriber 를 마무리 해봅시다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>sub</span><span class=o>/</span><span class=nx>main</span><span class=p>.</span><span class=k>go</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>ctx</span> <span class=p>=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>redisClient</span> <span class=p>=</span> <span class=nx>redis</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Addr</span><span class=p>:</span> <span class=s>&#34;localhost:6379&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>User</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Name</span>  <span class=kt>string</span> <span class=s>`json:&#34;name&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Email</span> <span class=kt>string</span> <span class=s>`json:&#34;email&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>subscriber</span> <span class=o>:=</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nf>Subscribe</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;채널명&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>user</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>msg</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>subscriber</span><span class=p>.</span><span class=nf>ReceiveMessage</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>Payload</span><span class=p>),</span> <span class=o>&amp;</span><span class=nx>user</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;메시지가&#34;</span> <span class=o>+</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>Channel</span> <span class=o>+</span> <span class=s>&#34; 채널에서 왔습니다.\n\n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%+v\n\n&#34;</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>subscriber 는 메시지를 받는 입장이니 publisher 채널을 구독해주어야겠죠.</p><p>publisher 에서 생성했던 채널을 구독해줍시다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>subscriber</span> <span class=o>:=</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nf>Subscribe</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;채널명&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>그리고 반복문을 돌며 메시지를 수신해주도록 하면됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>msg</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>subscriber</span><span class=p>.</span><span class=nf>ReceiveMessage</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>Payload</span><span class=p>),</span> <span class=o>&amp;</span><span class=nx>user</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;메시지가&#34;</span> <span class=o>+</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>Channel</span> <span class=o>+</span> <span class=s>&#34; 채널에서 왔습니다.\n\n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%+v\n\n&#34;</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=실행>실행<a hidden class=anchor aria-hidden=true href=#실행>#</a></h2><p>터미널 두개로 pub 과 sub 두개를 동시에 실행하였습니다.</p><p>publisher 실행</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> pub
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go run main.go
</span></span></code></pre></div><p>subscriber 실행</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> sub
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go run main.go
</span></span></code></pre></div><p><img loading=lazy src=https://heetaek.com/pubsub.gif alt=example></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://v8.network/tags/redis/>redis</a></li><li><a href=https://v8.network/tags/pubsub/>pubsub</a></li><li><a href=https://v8.network/tags/golam/>golam</a></li></ul><nav class=paginav><a class=prev href=https://v8.network/post/esbasic/><span class=title>« Prev</span><br><span>[Elastic Search] 기본 개념</span></a>
<a class=next href=https://v8.network/post/dbn+1/><span class=title>Next »</span><br><span>[데이터베이스] N + 1 문제</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://v8.network>V8 Network</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>